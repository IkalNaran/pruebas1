{% extends "base.html" %}
{% block title %}Vuelos en tiempo real{% endblock %}

{% block head_extra %}
	<!-- Leaflet CSS -->
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>
	<!-- DataTables Bootstrap 5 CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css" />
    <!-- noUiSlider CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nouislider@15.7.0/dist/nouislider.min.css" />
{% endblock %}

{% block content %}
	<div class="card">
		<div class="card-body">
			<h3 class="card-title">Vuelos en tiempo Real</h3>
			<p class="text-muted">Mapa interactivo con posiciones en vivo.</p>
			<div id="map" class="map map-large" style="height:50vh; min-height:360px; width:100%;"></div>

			<div class="row mt-3 g-2 align-items-end">
				<div class="col-sm-6 col-md-4">
					<label class="form-label small text-muted">Región</label>
					<select id="region-select" class="form-select form-select-sm">
						<option value="cdmx" selected>CDMX</option>
						<option value="valle">Valle de México</option>
						<option value="mexico">México</option>
						<option value="global">Global</option>
					</select>
				</div>
				<div class="col-sm-6 col-md-4">
					<label class="form-label small text-muted">Filtrar por tipo</label>
					<select id="filter-type" class="form-select form-select-sm">
						<option value="">Todos</option>
						<option value="commercial">Comercial</option>
						<option value="private">Privado</option>
						<option value="business">Empresarial</option>
						<option value="unknown">Desconocido</option>
					</select>
				</div>
				<div class="col-sm-6 col-md-4">
					<label class="form-label small text-muted">Aerolínea / Callsign</label>
					<select id="filter-airline" class="form-select form-select-sm">
						<option value="">Todas</option>
					</select>
				</div>
				<div class="col-sm-12 col-md-4">
					<div class="range-card">
						<div class="range-icon" aria-hidden="true">
							<!-- simple altitude SVG icon -->
							<svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="svg-alt">
								<path d="M12 2 L15 8 L12 6 L9 8 L12 2 Z" fill="#06b6d4" opacity="0.95"></path>
								<path d="M4 20h16v-2H4v2z" fill="#0b74ff" />
							</svg>
						</div>
						<div class="range-body">
							<label class="form-label small text-muted d-flex justify-content-between"><span>Altitud (m)</span><span class="text-muted small" id="alt-range-label">0 — 20000</span></label>
							<div id="slider-alt"></div>
							<input id="filter-alt-min" type="hidden" value="">
							<input id="filter-alt-max" type="hidden" value="">
						</div>
					</div>
				</div>
				<div class="col-sm-12 col-md-4">
					<div class="range-card">
						<div class="range-icon" aria-hidden="true">
							<!-- simple speed SVG icon -->
							<svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="svg-speed">
								<path d="M3 12a9 9 0 1 0 18 0" stroke="#f97316" stroke-width="1.6" fill="none" stroke-linecap="round"></path>
								<path d="M12 6v6l4 2" stroke="#fb7185" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></path>
							</svg>
						</div>
						<div class="range-body">
							<label class="form-label small text-muted d-flex justify-content-between"><span>Velocidad (m/s)</span><span class="text-muted small" id="speed-range-label">0 — 300</span></label>
							<div id="slider-speed"></div>
							<input id="filter-speed-min" type="hidden" value="">
							<input id="filter-speed-max" type="hidden" value="">
						</div>
					</div>
				</div>
			</div>

			<!-- Chips de filtros activos -->
			<div id="filter-chips" class="mt-2"></div>

			<!-- Tabla de vuelos detallada debajo del mapa -->
			<div class="table-responsive mt-3">
				<table id="flights-table" class="table table-sm table-striped table-hover align-middle w-100 flights-table">
					<thead>
						<tr>
							<th>Callsign</th>
							<th>ICAO24</th>
							<th>Tipo</th>
							<th>Salida</th>
							<th>Destino</th>
							<th>Alt (m)</th>
							<th>Vel (m/s)</th>
							<th>Heading</th>
							<th>Últ.</th>
						</tr>
					</thead>
					<tbody>
						<tr><td colspan="9" class="text-muted">Cargando vuelos...</td></tr>
					</tbody>
				</table>
			</div>
		</div>
	</div>
{% endblock %}

{% block body_extra %}
	<!-- Leaflet, Socket.IO and dashboard client -->
	<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
	<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
	<!-- jQuery + DataTables (BS5) -->
	<script src="https://code.jquery.com/jquery-3.6.0.min.js" crossorigin="anonymous"></script>
	<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
	<script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
	<!-- DataTables Buttons removed: clean table UI without toolbar -->
	<!-- noUiSlider -->
	<script src="https://cdn.jsdelivr.net/npm/nouislider@15.7.0/dist/nouislider.min.js"></script>
	<script src="{{ url_for('static', filename='js/realtime.js') }}"></script>
	<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock %}
