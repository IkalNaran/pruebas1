{% extends "base.html" %}
{% block title %}Monitoreo Zabbix{% endblock %}
{% block content %}
<!-- Dashboard layout: navbar cards, large map, bottom panel with charts and events -->
<div class="dashboard-container">
	<section class="top-row">
		<div class="status-cards">
			<div class="card" id="card-api">
				<div class="card-title">API OpenSky</div>
				<div class="card-value" id="api-status">—</div>
			</div>
			<div class="card" id="card-db">
				<div class="card-title">Base de datos</div>
				<div class="card-value" id="db-status">—</div>
			</div>
			<div class="card" id="card-backend">
				<div class="card-title">Backend</div>
				<div class="card-value" id="backend-status">—</div>
			</div>
			<div class="card" id="card-zabbix">
				<div class="card-title">Zabbix</div>
				<div class="card-value" id="zabbix-status">—</div>
			</div>
		</div>
	</section>

	<section class="main-area">
		<div id="map" class="map"></div>

		<aside class="right-panel">
			<h3>Resumen</h3>
			<ul class="summary-list">
				<li>Total vuelos activos: <strong id="total-flights">0</strong></li>
				<li>Promedio /min: <strong id="avg-per-min">0</strong></li>
				<li>Último trigger: <span id="last-trigger">—</span></li>
			</ul>

				<h4>Filtros</h4>
				<div class="filters">
					<label for="filter-airline">Aerolínea / Callsign</label>
					<select id="filter-airline">
						<option value="">Todas</option>
					</select>

					<label for="filter-alt-min">Altitud mínima (m)</label>
					<input id="filter-alt-min" type="number" placeholder="0" />

					<label for="filter-alt-max">Altitud máxima (m)</label>
					<input id="filter-alt-max" type="number" placeholder="20000" />

					<div style="margin-top:8px;display:flex;gap:8px;">
						<button id="apply-filters">Aplicar</button>
						<button id="clear-filters">Limpiar</button>
					</div>
				</div>

				<h4>Eventos Zabbix</h4>
				<div id="events" class="events"></div>
		</aside>
	</section>

	<section class="bottom-panel">
		<div class="chart-card">
			<canvas id="flightsChart" height="120"></canvas>
		</div>
		<div class="table-card">
			<h4>Tabla de vuelos</h4>
			<div id="flights-table">Cargando...</div>
		</div>
	</section>
</div>

<!-- Include required libs from CDN: Leaflet, Chart.js, Socket.IO -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>

<!-- Dashboard behaviour -->
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>

<style>
/* Minimal dashboard styles - you can move these to css/style.css */
.dashboard-container{display:flex;flex-direction:column;gap:16px;padding:12px}
.status-cards{display:flex;gap:12px}
.card{background:#0f1720;color:#fff;padding:10px;border-radius:8px;flex:1}
.card-title{font-size:0.9rem;color:#9ca3af}
.card-value{font-size:1.4rem;margin-top:6px}
.main-area{display:flex;gap:12px}
.map{flex:1;height:560px;border-radius:8px;overflow:hidden}
.right-panel{width:300px;background:#071126;color:#fff;padding:12px;border-radius:8px}
.bottom-panel{display:flex;gap:12px}
.chart-card{flex:1;background:#071126;padding:12px;border-radius:8px}
.table-card{width:360px;background:#071126;padding:12px;border-radius:8px}
.events{max-height:240px;overflow:auto}
/* responsive */
@media (max-width:900px){.main-area{flex-direction:column}.right-panel{width:100%}.map{height:420px}}
</style>

{% endblock %}
