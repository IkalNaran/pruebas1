{% extends "base.html" %}
{% block title %}Monitoreo Zabbix{% endblock %}
{% block content %}
<!-- Dashboard layout: navbar cards, large map, bottom panel with charts and events -->
<div class="dashboard-container">
	<div class="system-status">
		<div id="api-indicator" class="status-indicator status-unknown">
			<span class="dot"></span>
			<span id="api-indicator-text">API OpenSky: desconocido</span>
			<span id="api-last-checked" class="last-checked"></span>
		</div>
	</div>
	<section class="top-row">
		<div class="status-cards">
			<div class="card" id="card-api">
				<div class="card-title">API OpenSky</div>
				<div class="card-value" id="api-status">—</div>
			</div>
			<div class="card" id="card-db">
				<div class="card-title">Base de datos</div>
				<div class="card-value" id="db-status">—</div>
			</div>
			<div class="card" id="card-backend">
				<div class="card-title">Backend</div>
				<div class="card-value" id="backend-status">—</div>
			</div>
			<div class="card" id="card-zabbix">
				<div class="card-title">Zabbix</div>
				<div class="card-value" id="zabbix-status">—</div>
			</div>
		</div>
	</section>

	<section class="main-area">
		<div id="map" class="map"></div>

		<aside class="right-panel">
			<h3>Resumen</h3>
			<ul class="summary-list">
				<li>Total vuelos activos: <strong id="total-flights">0</strong></li>
				<li>Promedio /min: <strong id="avg-per-min">0</strong></li>
				<li>Último trigger: <span id="last-trigger">—</span></li>
			</ul>

				<h4>Filtros</h4>
				<div class="filters">
					<div class="filters-grid">
						<div class="field">
							<label for="filter-airline">Aerolínea / Callsign</label>
							<select id="filter-airline">
								<option value="">Todas</option>
							</select>
						</div>
						<div class="field">
							<label for="filter-country">País (origen)</label>
							<select id="filter-country">
								<option value="">Todos</option>
							</select>
						</div>

						<div class="field">
							<label for="filter-alt-min">Altitud mínima (m)</label>
							<input id="filter-alt-min" type="number" placeholder="0" />
						</div>
						<div class="field">
							<label for="filter-alt-max">Altitud máxima (m)</label>
							<input id="filter-alt-max" type="number" placeholder="20000" />
						</div>

						<div class="field">
							<label for="filter-speed-min">Velocidad mínima (m/s)</label>
							<input id="filter-speed-min" type="number" placeholder="0" />
						</div>
						<div class="field">
							<label for="filter-speed-max">Velocidad máxima (m/s)</label>
							<input id="filter-speed-max" type="number" placeholder="350" />
						</div>

						<div class="field full">
							<label>Categoría</label>
							<div class="cats">
								<label class="pill"><input type="checkbox" id="cat-com" checked /> Comerciales</label>
								<label class="pill"><input type="checkbox" id="cat-emp" checked /> Empresariales</label>
								<label class="pill"><input type="checkbox" id="cat-priv" checked /> Privados</label>
							</div>
						</div>

						<div class="field">
							<label for="filter-lat-min">Latitud mínima</label>
							<input id="filter-lat-min" type="number" step="0.0001" placeholder="18.90" />
						</div>
						<div class="field">
							<label for="filter-lat-max">Latitud máxima</label>
							<input id="filter-lat-max" type="number" step="0.0001" placeholder="19.80" />
						</div>

						<div class="field full">
							<label for="filter-text">Buscar texto</label>
							<input id="filter-text" type="text" placeholder="AMX, N123, XA-ABC" />
						</div>

						<div class="field full">
							<div class="buttons">
								<button id="apply-filters">Aplicar</button>
								<button id="clear-filters" class="ghost">Limpiar</button>
							</div>
						</div>
					</div>
				</div>

				<h4>Eventos Zabbix</h4>
				<div id="events" class="events"></div>
		</aside>
	</section>

	<section class="bottom-panel">
		<div class="chart-card">
			<canvas id="flightsChart" height="120"></canvas>
		</div>
		<div class="table-card">
			<h4>Tabla de vuelos</h4>
			<div id="flights-table">Cargando...</div>
		</div>
	</section>
</div>

<!-- Include required libs from CDN: Leaflet, Chart.js, Socket.IO -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>

<!-- Dashboard behaviour -->
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>


{% endblock %}
